name: AWS Credentials Persistence Demo

on:
  workflow_dispatch:

jobs:
  # Demo 1: Same-Job Persistence (The "Leak")
  demonstrate-persistence:
    runs-on: ubuntu-latest
    steps:
      - name: "Checkout code"
        uses: actions/checkout@v3

      - name: "Configure AWS Credentials (v1)"
        uses: aws-actions/configure-aws-credentials@v1
        continue-on-error: true
        with:
          aws-access-key-id: "AKIAIOSFODNN7EXAMPLE"
          aws-secret-access-key: "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
          aws-region: "us-east-1"

      - name: "Step 2: Access Credentials"
        run: |
          echo "=== Step 2: Immediate Access ==="
          if [ -n "$AWS_ACCESS_KEY_ID" ]; then
            echo "✅ Credentials available in Step 2"
            echo "Access Key: ${AWS_ACCESS_KEY_ID:0:10}..."
          else
            echo "❌ Credentials NOT found"
          fi

      - name: "Step 3: Access Credentials (Later Step)"
        run: |
          echo "=== Step 3: Persistence Check ==="
          if [ -n "$AWS_ACCESS_KEY_ID" ]; then
            echo "✅ Credentials STILL available in Step 3"
            echo "This confirms credentials persist for the entire job duration."
          fi

